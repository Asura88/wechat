#  文件上传绕过的一次思路总结（两个上传点组合Getshell）

Azjj98  [ Z2O安全攻防 ](javascript:void\(0\);)

**Z2O安全攻防** ![]()

微信号 Z2O_SEC

功能介绍 From zero to one

____

___发表于_

收录于合集 #实战 4个

  

点击上方[蓝字]，关注我们

 **建议大家把公众号“Z2O安全攻防”设为星标，否则可能就看不到啦！**
因为公众号现在只对常读和星标的公众号才能展示大图推送。操作方法：点击右上角的【...】，然后点击【设为星标】即可。

![]()

# 免责声明

本文仅用于技术讨论与学习，利用此文所提供的信息而造成的任何直接或者间接的后果及损失，均由使用者本人负责，文章作者及本公众号不为此承担任何责任。

# 文章正文

> 这是朋友的一个渗透测试的项目，有个上传的黑名单，我就试了一下，本文章是一边测试一边记录的，对于一些知识点总结的不全，只是提供了一个渗透中碰到上传的思路。

## 一丶测试上传正常文件

 **这里可以判定文件名虽然是重命名，但是可控的，因为我们上传的文件名被带进去了(*****_1.txt)这里利用的思路主要:**

1.目录没有执行权限（通过控制文件名进行../../跳目录，跳到可以执行脚本语言的目录）

2.上传文件找不到路径（通过控制文件名进行../../跳目录，层级跳到根目录进行访问）

3.上传白名单截断 （有些文件上传处是白名单，后缀名不可以绕，可以利用控制文件名截断的方式去绕过白名单，例如1.jsp%00.jpg）

4.截断文件前置名（这里后面会详细讲）

![]()

## 二丶测试上传非正常文件

 **这里主要观察是不是黑名单，或者说是没有限制名单，下图可以看到，上传tx格式是可以正常上传的，但是上传jsp文件就上传不成功。**
如果上传tx可以上传，但是jsp不可以，可以判断为上传黑名单，这里可以尝试绕黑名单的一下后缀格式，常见的绕黑名单的后缀格式有：aspx&asp：ashx、asa、asmx、cerphp：php3、phtmljsp：jspx、jspf这里简单列举几个，具体详细的我之前发的文章有，这里补充一个小知识点，假如站点为php的站点，但是只限制了php的后缀格式，我们这里可以利用别的脚本语言都测试一下，因为可能这个服务器可以运行多种语言，虽然概率比较低，但是没有好的绕过办法的时候可以试一下，万一成功了呢，我在项目中就碰到过这种情况上传tx后缀，上传成功：![]()

上传jsp 上传失败：

![]()

## 三、绕过测试

 **这里主要讲一下常见的一些绕上传的方法，这个是朋友给的站，我也不知道能不能绕过去，我也是一边绕一边记录着，是我绕上传的一个基本的思路，给大家学习一下**

上面测试了，上传黑名单，我们就先测试一下绕上传后缀

1.jspx绕过，失败，测试了别的php什么的都不可以，限制的比较全，html都不可以。

![]()

2.截断绕过

这里可以尝试 ：，；、%00、’、^
等都可以，这几种方法在windows服务器上成功率是比较高的，因为windows在创建文件的时候这些特殊字符是不允许出现的

![]()

最后测试利用 “：”截断成功了，但是很遗憾，虽然传上去了，也可以访问到，但是内容没有写进去，这就是利用：截断的一个弊端，只有文件，没有内容

![]()

3.利用跳目录

因为文件名可以控制，我们就可以利用../跳目录的方式去截断代码本身给添加的前置名，就此系统为例，我们上传1.txt，代码会自动给我们添加2022_06_20_1.txt,这里的利用思路就是上传配合解析的配置文件，例如上传.htaccess配合解析，当然这里实战应用的场景还有很多，只是提供一个思路

![]()![]()

我们这里也是成功截断前置名，并且跳到上层目录了，但是在此服务器这种方法并不是很好用，因为是java的站，利用此方式暂时没有好的getshell的方法，这里只是提供一下思路

## 四丶其他上传点继续测试

饶了半天始终是绕不过去，也不想绕了，但是文章都写到这里了，不能白白写啊，又问朋友要了个账号，测试一下后台有没有别的上传

功夫不负有心人，文章得以继续了

确实发现了另一个上传点

![]()

这个上传点比较有意思，后缀可以用大小写直接绕过

![]()

这不直接get了吗？

然而并不是，访问文件目录404？

![]()

通过查看附件的功能发现，查看附件处是用base64加密的一个绝对物理路径

![]()

这里就直接运用我们之前的跳目录，通过报错找到网站的真实路径（也有其他方法查找真实路径，我这里是用的报错），直接上传

![]()

 但是不妙呀！1.jsP访问直接下载呀！JSPX也是

![]()

这里就体现出我们之前跳目录加截断文件前置名的作用了

之前我们第一个上传点 ，可以利用：截断，上传jsp，但是文件内容传不上去，然后利用第二个上传点再上传一次同样文件名的文件 （1.jsp|1.jsP）

因为windows不区分大小写，所以就导致我们后面上传的1.jsP直接就把内容覆盖到1.jsp上面去了

![]()

最终获得大马一枚

![]()

##  五、总结

其实对于黑名单的绕过方式很多，之前发过一个上传绕过的文章文件上传漏洞总结(绕过方法)_Azjj98的博客-
CSDN博客_绕过上传漏洞有哪些方法并阐述其使用方法
具体可以看上面这个文章，但是现在在实战环境中，上传点的限制已经不只是代码层了，流量层的waf也是很恶心人，之前也写过文章Bypass
WAF实战总结_Azjj98的博客-CSDN博客_bypass waf 后面的话找机会把上传的绕过跟bypassWaf都好好总结一下，之前写的文章都不是很全

  *   * 

    
    
    https://blog.csdn.net/weixin_44578334/article/details/125382941作者：Azjj98

# 技术交流

### 知识星球

致力于红蓝对抗，实战攻防，星球不定时更新内外网攻防渗透技巧，以及最新学习研究成果等。常态化更新最新安全动态。专题更新奇技淫巧小Tips及实战案例。

涉及方向包括Web渗透、免杀绕过、内网攻防、代码审计、应急响应、云安全。星球中已发布 300+
安全资源，针对网络安全成员的普遍水平，并为星友提供了教程、工具、POC&EXP以及各种学习笔记等等。([点我了解详情](http://mp.weixin.qq.com/s?__biz=Mzg2ODYxMzY3OQ==&mid=2247496923&idx=1&sn=523f413df2d53de64fd48fbb081be790&chksm=ceab1f9bf9dc968da974eec5e34003d8a937884d2732fda7fac190360fd2a1a5290db090d8e9&scene=21#wechat_redirect))

![]()

### 学习圈子

一个引导大家一起成长，系统化学习的圈子。如果看到这里的师傅是基础不够扎实/技术不够全面/入行安全不久/有充足时间的初学者...其中之一，那么欢迎加入我们的圈子。在圈子内会每周规划学习任务，提供资料、技术文档，供大家一起学习、交流，由浅入深、层层递进。（[点我了解详情](http://mp.weixin.qq.com/s?__biz=Mzg2ODYxMzY3OQ==&mid=2247498684&idx=1&sn=71c923f29d6431f6271398d435f96ae0&chksm=ceab10fcf9dc99ea174325e6982af84d0331aeee2cb0196ac11405acd44283c18da31e77d553&scene=21#wechat_redirect)）

![]()

 ****

### 交流群

关注公众号回复“ **加群** ”，添加Z2OBot好友，自动拉你加入 **Z2O安全攻防交流群(微信群)** 分享更多好东西。
**（QQ群可直接扫码添加）**

![]()

  

### 关注我们

 **关注福利：**

 **回复“** **app** **" 获取   app渗透和app抓包教程**

 **回复“** **渗透字典** **" 获取 针对一些字典重新划分处理，收集了几个密码管理字典生成器用来扩展更多字典的仓库。**

 **回复“** **书籍** **"  获取 网络安全相关经典书籍电子版pdf**

 ** **回复“ 资料** **"  获取 网络安全、渗透测试相关资料文档****

 ** **  
****

点个【 在看 】，你最好看

预览时标签不可点

微信扫一扫  
关注该公众号

[知道了](javascript:;)

微信扫一扫  
使用小程序

****

[取消](javascript:void\(0\);) [允许](javascript:void\(0\);)

****

[取消](javascript:void\(0\);) [允许](javascript:void\(0\);)

： ， 。   视频 小程序 赞 ，轻点两下取消赞 在看 ，轻点两下取消在看

